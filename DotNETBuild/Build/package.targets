<Project>
    <PropertyGroup>
        <_GeneratedEntryPointFile>$(IntermediateOutputPath)$(MSBuildProjectName).Program.g$(DefaultLanguageSourceExtension)</_GeneratedEntryPointFile>
    </PropertyGroup>

    <Target Name="_GenerateRealEntryPointType"
            BeforeTargets="CoreCompile"
            DependsOnTargets="PrepareForBuild;CoreGenerateDragonFruitProgramFile"
            Condition="'$(DisableAutoGeneratedMain)' != 'true'">
        <PropertyGroup>
            <StartupObject>DotNETBuildSDK.Program</StartupObject>
        </PropertyGroup>
    </Target>

    <Target Name="CoreGenerateDragonFruitProgramFile"
            Condition="'$(Language)' == 'C#'"
            Outputs="$(_GeneratedEntryPointFile)">

        <PropertyGroup>
            <_GeneratedProgramFileContent >

                <![CDATA[
        // <auto-generated>This file was created automatically</auto-generated>
        using System.Runtime.CompilerServices;
        using System.Threading.Tasks;
        [CompilerGenerated]
        internal class AutoGeneratedProgram
        {
          public static async Task<int> Main(string[] args)
          {
            return await dotnetCampus.DotNETBuild.CommandLineDragonFruit.CommandLine.ExecuteAssemblyAsync(
              entryAssembly: typeof(global::AutoGeneratedProgram).Assembly,
              args: args,
           ]]>entryPointFullTypeName: "$([System.String]::Copy('$(StartupObject)').Trim())"<![CDATA[              
              );
          }
        }
]]>

            </_GeneratedProgramFileContent>

        </PropertyGroup>

        <WriteLinesToFile File="$(_GeneratedEntryPointFile)"
                          Overwrite="true"
                          Lines="$([MSBuild]::Escape($(_GeneratedProgramFileContent)))"
                          Encoding="Unicode"/>

        <ItemGroup>
            <Compile Include="$(_GeneratedEntryPointFile)" />
        </ItemGroup>
    </Target>
</Project>